<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CV & Resume Generator</title>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <style>
    :root {
      --primary-color: #2C3E50;
      --secondary-color: #3498DB;
      --background-color: #F4F6F7;
      --text-color: #2C3E50;
      --button-color: #2980B9;
      --button-hover-color: #1ABC9C;
      --input-background: #ECF0F1;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      margin: 20px;
      max-width: 850px;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: left;
      color: var(--primary-color);
      font-size: 28px;
      margin-bottom: 20px;
    }

    label {
      font-weight: bold;
      margin-top: 10px;
      color: var(--primary-color);
    }

    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      font-size: 14px;
      border: 1px solid var(--primary-color);
      border-radius: 5px;
      background-color: var(--input-background);
    }

    textarea {
      height: 130px;
      resize: vertical;
      white-space: pre-wrap;
    }

    .download-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }

    button {
      background-color: var(--button-color);
      color: white;
      padding: 12px 18px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: var(--button-hover-color);
    }

    input[type="file"] {
      padding: 5px;
      background-color: transparent;
      border: none;
    }
  </style>
</head>
<body>
  <h1>CV & Resume Generator</h1>

  <label for="employer">Employer's Name:</label>
  <input type="text" id="employer" placeholder="Enter employer's name">

  <label for="position">Position Title:</label>
  <input type="text" id="position" placeholder="Enter position title">

  <label for="jobDescription">Paste Job Description & Qualifications:</label>
  <textarea id="jobDescription" placeholder="Paste the job description and qualifications here..."></textarea>

  <label for="pdfTemplate">Upload PDF Template:</label>
  <input type="file" id="pdfTemplate" accept="application/pdf">

  <button onclick="generateDocuments()">Generate CV & Resume</button>

  <div class="download-container">
    <button onclick="downloadGeneratedPDF()">Download Customized PDF</button>
  </div>

  <script>
    const defaultSkills = [
      ".NET", ".NET Core", "3ds Max", "Adobe After Effects", "Adobe Photoshop", "Amazon EC2", "Amazon ECS",
      "Analysis skills", "Angular", "APIs", "ArcGIS", "ASP.NET Core", "AutoCAD", "AWS", "AWS Lambda", "Azure",
      "Back-end development", "CAD", "Civil 3D", "Construction", "CSS", "Data collection", "Data management",
      "Database administration", "Databases", "Docker", "Environmental consulting", "Environmental permitting",
      "GIS", "Git", "GitHub", "Go", "Google Cloud Platform", "HTML", "Java", "JavaScript", "Kubernetes", "Linux",
      "MicroStation", "Microsoft Excel", "Microsoft Outlook", "Microsoft Powerpoint", "Microsoft Word",
      "MySQL", "Node.js", "Oracle", "PostgreSQL", "Python", "React", "Revit", "SQL", "Terraform", "TypeScript",
      "Vue.js", "Web services", "WebSocket", "XML"
    ];

    const highPriorityKeywords = ["gis", "environmental", "utilities", "pipelines", "energy"];

    async function generateDocuments() {
      const employer = document.getElementById('employer').value.trim() || 'Hiring Manager';
      const position = document.getElementById('position').value.trim() || 'Position';
      const jobDescription = document.getElementById('jobDescription').value.trim().toLowerCase();
      const pdfFile = document.getElementById('pdfTemplate').files[0];

      if (!pdfFile) {
        alert('Please upload a PDF template first.');
        return;
      }

      const prioritizedSkills = prioritizeSkillsBasedOnJob(jobDescription);
      const formattedSkills = prioritizedSkills.join(', ');
      const tailoredParagraph = generateTailoredParagraph(jobDescription, position, formattedSkills);

      const reader = new FileReader();
      reader.onload = async function(e) {
        const pdfData = new Uint8Array(e.target.result);
        const pdfDoc = await PDFLib.PDFDocument.load(pdfData);
        const pages = pdfDoc.getPages();
        const date = new Date().toLocaleDateString();

        pages.forEach(page => {
          const { width, height } = page.getSize();

          const replacements = {
            '{{EMPLOYER}}': employer,
            '{{POSITION}}': position,
            '{{DATE}}': date,
            '{{SKILLS}}': formattedSkills,
            '{{PARAGRAPH}}': tailoredParagraph
          };

          Object.entries(replacements).forEach(([placeholder, value], index) => {
            page.drawText(value, {
              x: 50,
              y: height - 100 - (index * 35),
              size: 11,
              font: pdfDoc.getFont('Helvetica'),
              color: PDFLib.rgb(0.2, 0.2, 0.2),
              maxWidth: width - 100,
              lineHeight: 14
            });
          });
        });

        const modifiedPdfBytes = await pdfDoc.save();
        window.generatedPdfBytes = modifiedPdfBytes;
        alert('PDF generated successfully. Click "Download Customized PDF" to save it.');
      };

      reader.readAsArrayBuffer(pdfFile);
    }

    function prioritizeSkillsBasedOnJob(jobDescription) {
      return defaultSkills.sort((a, b) => {
        const indexA = jobDescription.indexOf(a.toLowerCase());
        const indexB = jobDescription.indexOf(b.toLowerCase());
        const isHighPriorityA = highPriorityKeywords.some(keyword => jobDescription.includes(keyword) && a.toLowerCase().includes(keyword));
        const isHighPriorityB = highPriorityKeywords.some(keyword => jobDescription.includes(keyword) && b.toLowerCase().includes(keyword));

        if (isHighPriorityA && !isHighPriorityB) return -1;
        if (!isHighPriorityA && isHighPriorityB) return 1;

        return (indexA === -1 ? Infinity : indexA) - (indexB === -1 ? Infinity : indexB);
      }).slice(0, 10); // Top 10 skills
    }

    function generateTailoredParagraph(jobDescription, position, formattedSkills) {
      let paragraph = `I am applying for the ${position} role with a strong background in software and technology relevant to this position. My experience with ${formattedSkills} enables me to effectively meet the job's technical requirements.`;

      if (jobDescription.includes('gis')) {
        paragraph = `With extensive experience in GIS technologies, I bring expertise in ${formattedSkills}. I am confident that my background aligns perfectly with the requirements of the ${position} role.`;
      } else if (highPriorityKeywords.some(keyword => jobDescription.includes(keyword))) {
        paragraph = `My work in sectors such as energy and environmental projects has equipped me with strong skills in ${formattedSkills}. I am eager to leverage this experience in the ${position} position.`;
      }

      return paragraph;
    }

    function downloadGeneratedPDF() {
      if (!window.generatedPdfBytes) {
        alert('Please generate the documents first.');
        return;
      }

      const blob = new Blob([window.generatedPdfBytes], { type: 'application/pdf' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `Michael_Ostrager_Customized_Document.pdf`;
      link.click();
    }
  </script>
</body>
</html>
