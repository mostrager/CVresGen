<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CV & Resume Generator</title>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 800px; }
    h1 { text-align: left; margin-bottom: 20px; }
    label { font-weight: bold; margin-top: 10px; }
    input, textarea, button, select { display: block; width: 100%; margin-top: 5px; }
    input, select { padding: 8px; font-size: 14px; }
    textarea { height: 150px; resize: vertical; font-size: 14px; white-space: pre-wrap; }
    .download-container { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
    button { padding: 10px; cursor: pointer; font-size: 14px; }
  </style>
</head>
<body>
  <h1>CV & Resume Generator</h1>

  <label for="employer">Employer's Name:</label>
  <input type="text" id="employer" placeholder="Enter employer's name">

  <label for="position">Position Title:</label>
  <input type="text" id="position" placeholder="Enter position title">

  <label for="jobDescription">Paste Job Description & Qualifications:</label>
  <textarea id="jobDescription" placeholder="Paste the job description and qualifications here..."></textarea>

  <label for="pdfTemplate">Upload PDF Template:</label>
  <input type="file" id="pdfTemplate" accept="application/pdf">

  <button onclick="generateDocuments()">Generate CV & Resume</button>

  <div class="download-container">
    <button onclick="downloadGeneratedPDF()">Download Customized PDF</button>
  </div>

  <script>
    async function generateDocuments() {
      const employer = document.getElementById('employer').value.trim() || 'Hiring Manager';
      const position = document.getElementById('position').value.trim() || 'Position';
      const jobDescription = document.getElementById('jobDescription').value.trim();
      const pdfFile = document.getElementById('pdfTemplate').files[0];

      if (!pdfFile) {
        alert('Please upload a PDF template first.');
        return;
      }

      const reader = new FileReader();
      reader.onload = async function(e) {
        const pdfData = new Uint8Array(e.target.result);
        const pdfDoc = await PDFLib.PDFDocument.load(pdfData);

        const pages = pdfDoc.getPages();
        const date = new Date().toLocaleDateString();

        pages.forEach(page => {
          const { width, height } = page.getSize();
          const textContent = page.getTextContent ? page.getTextContent() : '';

          // Replace placeholders
          page.drawText(page.getTextContent().items.reduce((acc, item) => {
            return acc.replace('{{EMPLOYER}}', employer)
                      .replace('{{POSITION}}', position)
                      .replace('{{DATE}}', date);
          }, textContent), {
            x: 50,
            y: height - 100,
            size: 11,
            font: pdfDoc.getFont('Helvetica'),
            color: PDFLib.rgb(0, 0, 0),
          });
        });

        const modifiedPdfBytes = await pdfDoc.save();
        window.generatedPdfBytes = modifiedPdfBytes; // Store for download
        alert('PDF generated successfully. Click "Download Customized PDF" to save it.');
      };

      reader.readAsArrayBuffer(pdfFile);
    }

    function downloadGeneratedPDF() {
      if (!window.generatedPdfBytes) {
        alert('Please generate the documents first.');
        return;
      }

      const blob = new Blob([window.generatedPdfBytes], { type: 'application/pdf' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `Michael_Ostrager_Customized_Document.pdf`;
      link.click();
    }
  </script>
</body>
</html>
